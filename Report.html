<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Report_files/libs/clipboard/clipboard.min.js"></script>
<script src="Report_files/libs/quarto-html/quarto.js"></script>
<script src="Report_files/libs/quarto-html/popper.min.js"></script>
<script src="Report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Report_files/libs/quarto-html/anchor.min.js"></script>
<link href="Report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<hr>
<hr>
<p>title: “Data Model SPZ” format: html editor: visual</p>
<hr>
<section id="data-loading" class="level1">
<h1>Data loading</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(treemap)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid) </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(icd.data)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(treemap)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#colors</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>palet <span class="ot">&lt;-</span> <span class="fu">get_palette</span>(<span class="at">palette=</span><span class="st">"lancet"</span>,<span class="dv">10</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#We upload Data</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>codes <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"C:/Users/boris/Desktop/data hospital/codes_2phases.xlsx"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># SCIM values 2017-2020</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>SCIM_17_20 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"C:/Users/boris/Desktop/data hospital/Auswertung_SCIM_2017-20201.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting logical in F4131 / R4131C6: got 'ja'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We convert the patient code to character</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>SCIM_17_20 <span class="ot">&lt;-</span> SCIM_17_20 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">FID=</span><span class="fu">as.character</span>(FID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the previous data set we need to know that the key variable that identifies every row is the column FID. Note that FID means case identification number.</p>
<ul>
<li>FID: Fallidentifikationsnummer</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SCIM_17_20 <span class="sc">%&gt;%</span> <span class="fu">select</span>(FID) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()<span class="sc">%&gt;%</span><span class="fu">select</span>(Freq)<span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Freq
   1    2 
1119 3240 </code></pre>
</div>
</div>
<p>From the last outcome we observe that there are <em>FID</em> repeated at most twice. It probably means two different SCIM values. In fact let’s select the first five FID values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fives <span class="ot">&lt;-</span> SCIM_17_20 <span class="sc">%&gt;%</span> <span class="fu">select</span>(FID) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(FID)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fives</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FID
1 5205639
2 5207178
3 5208756
4 5210382
5 5211089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>SCIM_17_20 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(FID <span class="sc">%in%</span> fives<span class="sc">$</span>FID)<span class="sc">%&gt;%</span><span class="fu">select</span>(FID,SCIM_TOTAL,DATUM) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(FID,DATUM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   FID     SCIM_TOTAL DATUM              
   &lt;chr&gt;   &lt;chr&gt;      &lt;dttm&gt;             
 1 5205639 15         2015-10-29 00:00:00
 2 5205639 21         2017-08-16 00:00:00
 3 5207178 17         2016-01-01 00:00:00
 4 5207178 42         2017-04-25 00:00:00
 5 5208756 14         2016-03-01 00:00:00
 6 5208756 63         2017-02-08 00:00:00
 7 5210382 14         2017-04-11 00:00:00
 8 5210382 14         2017-04-19 00:00:00
 9 5211089 12         2016-05-01 00:00:00
10 5211089 84         2017-03-01 00:00:00</code></pre>
</div>
</div>
</section>
<section id="analysis-two-phases" class="level1">
<h1>Analysis two phases</h1>
<p>Here we consider the data set <strong>codes</strong> This data set has two columns <strong>code1</strong> and <strong>code2</strong>. Both codes corresponds to the same <strong>patient</strong>, in different phases. Therefore, is important to keep in mind this feature because based on these codes we will analyze the evolution of SCIM values and it will help us to aggregate cases.</p>
<ul>
<li>code 1: Acute Phase</li>
<li>code 2: Rehabilitation Phase</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(codes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  code1   date                code2  
  &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;  
1 6012487 2017-12-07 00:00:00 6014266
2 6023881 2018-12-06 00:00:00 6025255
3 6028398 2019-04-09 00:00:00 6028919
4 6040865 2020-08-10 00:00:00 6041525
5 6043203 2020-10-30 00:00:00 6043916
6 6017204 2018-04-30 00:00:00 6018809</code></pre>
</div>
</div>
<p>Additionally, is crucial to note that:</p>
<p>- There are not duplicated values in the table <span class="math inline">\(codes\)</span></p>
<p>- There are duplicated FID in the table <span class="math inline">\(SCIM\_17\_20.\)</span></p>
</section>
<section id="information-about-patients-diagnosis-and-treatments." class="level1">
<h1>Information about patients, diagnosis and treatments.</h1>
<p>In this stage we consider two additional data sets.</p>
<p>The <strong>mb</strong> is the dataset with information about health diagnosis, treatments, age, sex among others.</p>
<p>The data set <strong>fid_pid</strong> is a data set that contains a correspondence between FID and PID.</p>
<ul>
<li>PID: Patienten fallnummer that is the patient case number.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mb<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"C:/Users/boris/Desktop/SPZ hospital/SPZ-Project/mb.rds"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>asiaclass<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"C:/Users/boris/Desktop/SPZ hospital/SPZ-Project/asiaclass.rds"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>mb_asia<span class="ot">&lt;-</span><span class="fu">merge</span>(mb,asiaclass,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"FID"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>fid_pid <span class="ot">&lt;-</span>  <span class="fu">readRDS</span>(<span class="st">"C:/Users/boris/Desktop/SPZ hospital/SPZ-Project/fidpid.rds"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  les_lev gender birth_date age_admi resid      entry class stay_intcareunit
1   G8260      1   19630105       55  9462 2018091300     2                0
2   G8260      1   19690920       50  3018 2019122007     1                0
3   G8260      1   19550810       64  8800 2020011107     1                0
4   G8260      2   19870614       32  8630 2019121800     1                0
5   G8260      1   19800523       39  4492 2019092307     1                0
6   G8260      1   19671106       51  2000 2019022007     1                0
  main_cost_center      leave stay_aft_leav main_diag add_main_diag add_diag1
1                1 2018100823             5      G950          &lt;NA&gt;     S4221
2                1 2020010923            55     G8230          &lt;NA&gt;     G8260
3                4 2020012511             1     G8242          &lt;NA&gt;     G8260
4                1 2020022110             1     L8925          &lt;NA&gt;      B956
5                4 2019092711             1      K642          &lt;NA&gt;     G8242
6                4 2019022116             1     G4738          &lt;NA&gt;      Z991
  add_diag2 add_diag3 add_diag4 add_diag5 add_diag6 add_diag7 add_diag8
1     G8242     G8260     M8128      Z223      B962      &lt;NA&gt;      &lt;NA&gt;
2      Z488     M4642     G9582     J9609      Z430      A490      B956
3      Z508      N210     N3188     J9610      T835      Y828      B965
4     G8243     G8260      N210     G9584      Z435      &lt;NA&gt;      &lt;NA&gt;
5     G8260      Z881     I1090      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;
6     G8243     G8260      Z435     G9584      Z881      &lt;NA&gt;      &lt;NA&gt;
  begin_main_treat fur_treat1 fur_treat2 fur_treat3 fur_treat4 fur_treat5
1              371 2018100807     99C110     889410     883820     889410
2            93872 2019122007      93399       9383      890A3      93701
3            93872 2020011107       9319      93399       9383      570X1
4           862A1E 2019122707     99C12G     867E1E     570X10       5994
5            49461 2019092307      99C11      009A1        991       &lt;NA&gt;
6            89381 2019022007      89381       8922       5732       &lt;NA&gt;
  fur_treat6 fur_treat7 fur_treat8 fur_treat9 fur_treat10      id year
1     889714     889810     883840      30926          36 6022710 2018
2        311       4311      89381       &lt;NA&gt;        &lt;NA&gt; 6035865 2019
3       5994      AA211      AA321      AA322       AA323 6035854 2019
4     AA2117     AA3211     AA3221     AA3231      AA3241 6035716 2020
5       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;        &lt;NA&gt; 6032762 2019
6       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;        &lt;NA&gt; 6026011 2019
  length_stay Lesion.x les
1     25 days    C1-C3   C
2     20 days    C1-C3   C
3     14 days    C1-C3   C
4     65 days    C1-C3   C
5      4 days    C1-C3   C
6      1 days    C1-C3   C</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fid_pid <span class="sc">%&gt;%</span> <span class="fu">select</span>(PID) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Freq) <span class="sc">%&gt;%</span> <span class="fu">table</span>()<span class="sc">|&gt;</span> <span class="fu">data.frame</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Freq Freq.1
1     1   1664
2     2    888
3     3    258
4     4    125
5     5     76
6     6     45
7     7     21
8     8     11
9     9     10
10   10      5
11   11      3
12   12      1
13   13      1
14   16      1</code></pre>
</div>
</div>
<p>In the previous table we could appreciate that the frequencies of each patient PID is at most 14.</p>
</section>
<section id="variables-time-and-cost-of-interventions" class="level1">
<h1>Variables time and cost of interventions</h1>
<p>We include variables that represent the time and cost for each intervention to every patient</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>time_cost <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"time_cost.rds"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Important to discuss--- here we are aggregating by year....</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Therefore the estimations are given for all the period</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="do">## SUGGESTION: What about if we present first a descriptive analyisis of the amounts by year:</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>serv_cons <span class="ot">&lt;-</span> time_cost <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>year) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">op_room=</span><span class="fu">sum</span>(op_room),<span class="at">anaest=</span><span class="fu">sum</span>(anaest),<span class="at">int_care=</span><span class="fu">sum</span>(int_care),<span class="at">imag=</span><span class="fu">sum</span>(imag),<span class="at">lab=</span><span class="fu">sum</span>(lab),<span class="at">physt=</span><span class="fu">sum</span>(physt),<span class="at">ergo=</span><span class="fu">sum</span>(ergo),<span class="at">logo=</span><span class="fu">sum</span>(logo),<span class="at">non_med=</span><span class="fu">sum</span>(non_med_ter),<span class="at">nurs=</span><span class="fu">sum</span>(nurs),<span class="at">psyc=</span><span class="fu">sum</span>(psyc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The units are given by:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  unts<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"min"</span>,<span class="st">"min"</span>,<span class="st">"min"</span>,<span class="st">"chf"</span>,<span class="st">"chf"</span>,<span class="st">"min"</span>,<span class="st">"min"</span>,<span class="st">"min"</span>,<span class="st">"tp"</span>,<span class="st">"min"</span>,<span class="st">"tp"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  unts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "min" "min" "min" "chf" "chf" "min" "min" "min" "tp"  "min" "tp" </code></pre>
</div>
</div>
<p>Summarizing, we have the next important data sets.</p>
<ul>
<li><p>mb</p></li>
<li><p>codes</p></li>
<li><p>SCIM_17_20</p></li>
<li><p>fid_pid</p></li>
<li><p>time_cost</p></li>
</ul>
</section>
<section id="evolution-of-scim" class="level1">
<h1>Evolution of SCIM</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>SCIM_17_20 <span class="sc">%&gt;%</span> <span class="fu">select</span>(FID) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()<span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>Freq)<span class="sc">%&gt;%</span><span class="fu">head</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FID Freq
1 5205639    2
2 5207178    2
3 5208756    2
4 5210382    2
5 5211089    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mb<span class="sc">%&gt;%</span> <span class="fu">select</span>(id) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()<span class="sc">%&gt;%</span><span class="fu">arrange</span>(<span class="sc">-</span>Freq) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id Freq
1 6006658    2
2 6008272    2
3 6008830    2
4 6009414    2
5 6009503    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>time_cost <span class="sc">%&gt;%</span> <span class="fu">select</span>(id) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>Freq) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id Freq
1 5211529    2
2 6006658    2
3 6008272    2
4 6008830    2
5 6009414    2
6 6009503    2
7 6009636    2
8 6009808    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fid_pid <span class="sc">%&gt;%</span> <span class="fu">select</span>(FID) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()<span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>Freq) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FID Freq
1 5205639    1
2 5207178    1
3 5208756    1
4 5210382    1
5 5211089    1
6 5211529    1
7 5211936    1
8 5212187    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fid_pid <span class="sc">%&gt;%</span> <span class="fu">select</span>(PID) <span class="sc">%&gt;%</span> <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()<span class="sc">%&gt;%</span> <span class="fu">arrange</span>(PID) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        PID Freq
1   0000355    2
2   0000362    5
3   0000374   11
4   0000387    1
5   0000390    1
6   0000407    1
7   0000415    1
8   0000430    1
9   0000453    1
10  0000459    1
11  0000466    1
12  0000477    2
13  0000489    2
14  0000490    1
15  0000511    2
16  0000523    1
17  0000532    2
18  0000536    1
19  0000541    2
20  0000548    4
21  0000559    2
22  0000567    3
23  0000578    1
24  0000582    1
25  0000595    6
26  0000598    4
27  0000604    1
28  0000617    1
29  0000624    4
30  0000633    5
31  0000635    1
32  0000638    1
33  0000657    2
34  0000674    3
35  0000686    1
36  0000715    2
37  0000722    1
38  0000724    1
39  0000725    3
40  0000733    1
41  0000743    1
42  0000753    1
43  0000758    2
44  0000763    3
45  0000788    6
46  0000806    1
47  0000834    1
48  0000837    2
49  0000840    1
50  0000850    3
51  0000868    5
52  0000878    1
53  0000883    1
54  0000890    4
55  0000891    2
56  0000897    1
57  0000898    1
58  0000900    2
59  0000910    1
60  0000927    2
61  0000934    1
62  0000940    5
63  0000948    2
64  0000949    1
65  0000953    1
66  0001002    1
67  0001007    3
68  0001028    4
69  0001031    1
70  0001035    3
71  0001082    3
72  0001104    4
73  0001118    4
74  0001122    5
75  0001140    1
76  0001168    2
77  0001173    1
78  0001190    2
79  0001197    2
80  0001202    2
81  0001205    1
82  0001230    5
83  0001231    3
84  0001262    4
85  0001292    1
86  0001302    1
87  0001306    2
88  0001323   12
89  0001328    1
90  0001332    1
91  0001340    2
92  0001356    6
93  0001383    2
94  0001384    1
95  0001386    2
96  0001404    1
97  0001421    5
98  0001444    3
99  0001456    2
100 0001463    8</code></pre>
</div>
</div>
<p>From the previous summaries we observe that in the table <em>fip_pid</em>, there are some <em>PID</em> codes repeated <span class="math inline">\(16\)</span> times. It means that the patient considered was $16$ times in the clinic, each time with a different FID code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fid_pid <span class="sc">|&gt;</span> <span class="fu">filter</span>(PID<span class="sc">==</span><span class="st">"0152021"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   FID     PID    
   &lt;chr&gt;   &lt;chr&gt;  
 1 5211529 0152021
 2 6009261 0152021
 3 6011127 0152021
 4 6012509 0152021
 5 6013263 0152021
 6 6015622 0152021
 7 6021794 0152021
 8 6023916 0152021
 9 6025811 0152021
10 6027140 0152021
11 6029079 0152021
12 6031905 0152021
13 6034556 0152021
14 6035696 0152021
15 6037398 0152021
16 6040704 0152021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fid_pid <span class="sc">|&gt;</span> <span class="fu">filter</span>(PID<span class="sc">==</span><span class="st">"0152021"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(FID) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
</div>
<p>In order to analyze the evolution of the SCIM value we consider the next steps.</p>
<p>Due to the importance of track the acute and rehabilitation phase we merge the mb data set with the data set codes. Note that an important issue could be the treatment of the codes for acute and rehabilitation phase.</p>
<p>In order to deal with that we proceed as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a code uni_n in the codes table</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>codes<span class="sc">$</span>uniq<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">"uni"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(codes),<span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(codes,<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   code1   date                code2   uniq  
   &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;   &lt;chr&gt; 
 1 6012487 2017-12-07 00:00:00 6014266 uni_1 
 2 6023881 2018-12-06 00:00:00 6025255 uni_2 
 3 6028398 2019-04-09 00:00:00 6028919 uni_3 
 4 6040865 2020-08-10 00:00:00 6041525 uni_4 
 5 6043203 2020-10-30 00:00:00 6043916 uni_5 
 6 6017204 2018-04-30 00:00:00 6018809 uni_6 
 7 6040437 2020-07-27 00:00:00 6041208 uni_7 
 8 6016770 2018-03-28 00:00:00 6017875 uni_8 
 9 6013568 2017-12-18 00:00:00 6014569 uni_9 
10 6025398 2019-01-29 00:00:00 6026686 uni_10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>codes_asia1<span class="ot">&lt;-</span>codes<span class="sc">|&gt;</span><span class="fu">merge</span>(asiaclass,<span class="at">by.x=</span><span class="st">"code1"</span>,<span class="at">by.y=</span><span class="st">"FID"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>codes_asia2<span class="ot">&lt;-</span>codes<span class="sc">|&gt;</span><span class="fu">merge</span>(asiaclass,<span class="at">by.x=</span><span class="st">"code2"</span>,<span class="at">by.y=</span><span class="st">"FID"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>codes_asia<span class="ot">&lt;-</span><span class="fu">rbind</span>(codes_asia1,codes_asia2)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>SCIM_17_20 <span class="sc">%&gt;%</span> <span class="fu">select</span>(FID) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4359</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that when we merge SCIM_17_20 with codes not all codes match, because</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># not all of them were in two phases</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>SCIM_17_20 <span class="sc">%&gt;%</span> <span class="fu">select</span>(FID) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(codes<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">ph=</span><span class="st">"acute"</span>),<span class="at">by.x=</span><span class="st">"FID"</span>,<span class="at">by.y=</span><span class="st">"code1"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1638</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1638 matches in acute phase</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with code 1 acute phase</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> SCIM_17_20  <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(codes,<span class="at">by.x=</span><span class="st">"FID"</span>,<span class="at">by.y=</span><span class="st">"code1"</span>,<span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(P1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FID    NR PATIENT_NR FALL_NR KURZZEICHEN LASTMEASURE SP_NAHRUNG
1 5205639 36604      73510      34         CUS          NA          0
2 5205639 46713      73510      34        PUNO          NA          0
3 5207178 38222     396796       2         HON          NA          1
4 5207178 44542     396796       2        SILG          NA          2
5 5208756 38801     398190       3        ROBA          NA          2
6 5208756 42935     398190       3        ENBE          NA          3
  SP_WASCHEN_OBER SP_WASCHEN_UNTER SP_ANZIEHEN_OBER SP_ANZIEHEN_UNTER
1               0                0                0                 0
2               0                0                0                 0
3               0                0                0                 0
4               0                0                1                 1
5               1                0                0                 0
6               3                1                4                 2
  SP_GESICHT SP_SUB AS_ATMUNG AS_BLASE AS_DARM AS_TOILETTE AS_SUB MH_BETT
1          0      0        10        0       5           0     15       0
2          0      0        10        3       5           0     18       0
3          1      2         4        3       5           0     12       0
4          0      4        10        6      10           1     27       2
5          1      4        10        0       0           0     10       0
6          3     16        10       11      10           5     36       4
  MH_TRANSFER_BETT MH_TRANSFER_WC MH_SUB MA_HAUS MA_MITTLERE_DISTANZ
1                0              0      0       0                   0
2                0              0      0       1                   1
3                0              0      0       1                   1
4                2              1      5       2                   2
5                0              0      0       0                   0
6                2              1      7       1                   1
  MA_AUSSER_HAUS MA_TREPPEN MA_TRANSFER_AUTO MA_TRANSFER_BODEN MA_SUB
1              0          0                0                 0      0
2              1          0                0                 0      3
3              1          0                0                 0      3
4              1          0                1                 0      6
5              0          0                0                 0      0
6              1          0                1                 0      4
  SCIM_TOTAL      DATUM   ERZEUGER     ERZEUGUNGSDATUM AENDERER AENDERUNGSDATUM
1         15 2015-10-29    SMITH_C 2015-10-29 22:15:23       NA              NA
2         21 2017-08-16   PUERRO_N 2017-08-16 08:10:28       NA              NA
3         17 2016-01-01    HOFER_N 2015-12-31 07:57:54       NA              NA
4         42 2017-04-25  GRETHER_S 2017-04-25 14:59:53       NA              NA
5         14 2016-03-01 BACHMANN_R 2016-02-26 11:13:36       NA              NA
6         63 2017-02-08   ENDERS_B 2017-02-06 08:37:41       NA              NA
                          ERZ_CLIENT_INFO ERSTELLER_ERGO ERSTELLER_PFLEGE
1  KgEd32@SPGVCMP00026-3.0.0.0-2.2.0.1921           JUST              CUS
2      KgEd32@SPG16010-3.0.0.0-2.2.0.2143            CLE             PUNO
3  KgEd32@SPGVCMP00040-3.0.0.0-2.2.0.2027           ANWA              REC
4      KgEd32@SPG01806-3.0.0.0-2.2.0.2143           SILG              NIV
5      KgEd32@SPG01734-3.0.0.0-2.2.0.2054           FENI             BYZY
6 KgEd32@SPGPVCMP00065-3.0.0.0-2.2.0.2085           ENBE              BER
  ERSTELLER_PHYSIO SP_NAHRUNG_AE SP_WASCHEN_OBER_AE SP_WASCHEN_UNTER_AE
1             KOST           CUS                CUS                 CUS
2             KOST          PUNO               PUNO                PUNO
3              HON           REC                REC                 REC
4             SILG           NIV                NIV                 NIV
5             ROSE          BYZY               BYZY                BYZY
6              JED           BER                BER                 BER
  SP_ANZIEHEN_OBER_AE SP_ANZIEHEN_UNTER_AE SP_GESICHT_AE AS_ATMUNG_AE
1                 CUS                  CUS           CUS          CUS
2                PUNO                 PUNO          PUNO         PUNO
3                 REC                  REC           REC          REC
4                 NIV                  NIV           NIV          NIV
5                BYZY                 BYZY          BYZY         BYZY
6                 BER                  BER           BER          BER
  AS_BLASE_AE AS_DARM_AE AS_TOILETTE_AE MH_BETT_AE MH_TRANSFER_BETT_AE
1         CUS        CUS            CUS        CUS                JUST
2        PUNO       PUNO           PUNO       PUNO                 CLE
3         REC        REC            REC        REC                ANWA
4         NIV        NIV            NIV        NIV                SILG
5        BYZY       BYZY           BYZY       BYZY                FENI
6         BER        BER            BER        BER                ENBE
  MH_TRANSFER_WC_AE MA_HAUS_AE MA_MITTLERE_DISTANZ_AE MA_AUSSER_HAUS_AE
1              JUST       KOST                   KOST              KOST
2               CLE       KOST                   KOST              KOST
3              ANWA        HON                    HON               HON
4              SILG       SILG                   SILG              SILG
5              FENI       ROSE                   ROSE              ROSE
6              ENBE        JED                    JED               JED
  MA_TREPPEN_AE MA_TRANSFER_AUTO_AE MA_TRANSFER_BODEN_AE KF_VERSTEHEN_AE
1          KOST                JUST                 KOST            &lt;NA&gt;
2          KOST                 CLE                 KOST             CLE
3           HON                ANWA                  HON            &lt;NA&gt;
4          SILG                SILG                 SILG            &lt;NA&gt;
5          ROSE                FENI                 ROSE            &lt;NA&gt;
6           JED                ENBE                  JED            &lt;NA&gt;
  KF_VERSTEHEN KF_KOMMUNIKATION_VERSTEHEN KF_KOMMUNIKATION_VERSTEHEN_AE
1         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
2            7                 3 = beides                           CLE
3         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
4         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
5         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
6         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
  KF_AUSDRUCK KF_AUSDRUCK_AE KF_KOMMUNIKATION_AUSDRUCK
1        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
2           7            CLE                3 = beides
3        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
4        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
5        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
6        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
  KF_KOMMUNIKATION_AUSDRUCK_AE KF_SOZIALES_VERHALTEN KF_SOZIALES_VERHALTEN_AE
1                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
2                          CLE                     7                      CLE
3                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
4                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
5                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
6                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
  KF_PROBLEM_LOESUNG KF_PROBLEM_LOESUNG_AE KF_SUB date code2 uniq
1               &lt;NA&gt;                  &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;
2                  7                   CLE     34 &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;
3               &lt;NA&gt;                  &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;
4               &lt;NA&gt;                  &lt;NA&gt;      - &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;
5               &lt;NA&gt;                  &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;
6               &lt;NA&gt;                  &lt;NA&gt;      - &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with code 2 rehabilitation phase</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> P1 <span class="sc">%&gt;%</span> <span class="fu">merge</span>(codes,<span class="at">by.x=</span><span class="st">"FID"</span>,<span class="at">by.y=</span><span class="st">"code2"</span>,<span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For example</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(P2[<span class="fu">c</span>(<span class="dv">71</span>,<span class="dv">72</span>,<span class="dv">73</span>,<span class="dv">74</span>,<span class="dv">449</span>,<span class="dv">450</span>,<span class="dv">451</span>,<span class="dv">452</span>),])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        FID    NR PATIENT_NR FALL_NR KURZZEICHEN LASTMEASURE SP_NAHRUNG
71  5215438 42899       9567      52        BUIR          NA          2
72  5215438 42730       9567      52        ALLU          NA          2
73  5215452 41365     393174       3        MAME          NA          3
74  5215452 42776     393174       3        MAME          NA          3
449 6002536 42900     170836       6        MEOS          NA          2
450 6002536 47031     170836       6        JEDI          NA          2
    SP_WASCHEN_OBER SP_WASCHEN_UNTER SP_ANZIEHEN_OBER SP_ANZIEHEN_UNTER
71                1                0                0                 0
72                0                0                0                 0
73                3                3                4                 4
74                3                3                4                 4
449               1                0                1                 0
450               3                2                2                 1
    SP_GESICHT SP_SUB AS_ATMUNG AS_BLASE AS_DARM AS_TOILETTE AS_SUB MH_BETT
71           3      6        10        3       5           0     18       0
72           2      4        10        0       5           0     15       0
73           3     20        10        0       0           5     15       6
74           3     20        10       11      10           4     35       6
449          1      5        10        0       5           0     15       2
450          3     13        10       15      10           4     39       6
    MH_TRANSFER_BETT MH_TRANSFER_WC MH_SUB MA_HAUS MA_MITTLERE_DISTANZ
71                 0              0      0       0                   0
72                 0              0      0       2                   2
73                 2              1      9       2                   2
74                 2              1      9       2                   2
449                0              0      2       0                   0
450                2              1      9       4                   4
    MA_AUSSER_HAUS MA_TREPPEN MA_TRANSFER_AUTO MA_TRANSFER_BODEN MA_SUB
71               0          0                0                 0      0
72               2          0                0                 0      6
73               2          0                2                 0      8
74               2          0                2                 1      9
449              0          0                0                 0      0
450              4          2                1                 0     15
    SCIM_TOTAL      DATUM    ERZEUGER     ERZEUGUNGSDATUM AENDERER
71          24 2017-02-01    SCHAUB_I 2017-02-01 11:17:38       NA
72          25 2017-01-18      LUTZ_A 2017-01-20 14:25:42       NA
73          52 2016-09-19   MERLONI_M 2016-09-22 13:09:13       NA
74          73 2017-01-27   MERLONI_M 2017-01-27 16:47:49       NA
449         22 2017-02-01     OSELE_M 2017-02-01 12:58:12       NA
450         76 2017-08-28 DIENEMANN_J 2017-08-25 08:56:03       NA
    AENDERUNGSDATUM                         ERZ_CLIENT_INFO ERSTELLER_ERGO
71               NA KgEd32@SPGPVCMP00050-3.0.0.0-2.2.0.2085           ALLU
72               NA KgEd32@SPGPVCMP00035-3.0.0.0-2.2.0.2085           ALLU
73               NA KgEd32@SPGPVCMP00060-3.0.0.0-2.2.0.2085           MAME
74               NA KgEd32@SPGPVCMP00016-3.0.0.0-2.2.0.2085           MAME
449              NA KgEd32@SPGPVCMP00037-3.0.0.0-2.2.0.2085           MAME
450              NA KgEd32@SPGPVCMP00035-3.0.0.0-2.2.0.2143           MAME
    ERSTELLER_PFLEGE ERSTELLER_PHYSIO SP_NAHRUNG_AE SP_WASCHEN_OBER_AE
71               LAC             BUIR           LAC                LAC
72               LAU             BUIR           LAU                LAU
73               BAE             LOSA           BAE                BAE
74              BEIS             LOSA          BEIS               BEIS
449             THAN             MEOS          THAN               THAN
450             THAN             JEDI          THAN               THAN
    SP_WASCHEN_UNTER_AE SP_ANZIEHEN_OBER_AE SP_ANZIEHEN_UNTER_AE SP_GESICHT_AE
71                  LAC                 LAC                  LAC           LAC
72                  LAU                 LAU                  LAU           LAU
73                  BAE                 BAE                  BAE           BAE
74                 BEIS                BEIS                 BEIS          BEIS
449                THAN                THAN                 THAN          THAN
450                THAN                THAN                 THAN          THAN
    AS_ATMUNG_AE AS_BLASE_AE AS_DARM_AE AS_TOILETTE_AE MH_BETT_AE
71           LAC         LAC        LAC            LAC        LAC
72           LAU         LAU        LAU            LAU        LAU
73           BAE         BAE        BAE            BAE        BAE
74          BEIS        BEIS       BEIS           BEIS       BEIS
449         THAN        THAN       THAN           THAN       THAN
450         THAN        THAN       THAN           THAN       THAN
    MH_TRANSFER_BETT_AE MH_TRANSFER_WC_AE MA_HAUS_AE MA_MITTLERE_DISTANZ_AE
71                 ALLU              ALLU       BUIR                   BUIR
72                 ALLU              ALLU       BUIR                   BUIR
73                 MAME              MAME       LOSA                   LOSA
74                 MAME              MAME       LOSA                   LOSA
449                MAME              MAME       MEOS                   MEOS
450                MAME              MAME       JEDI                   JEDI
    MA_AUSSER_HAUS_AE MA_TREPPEN_AE MA_TRANSFER_AUTO_AE MA_TRANSFER_BODEN_AE
71               BUIR          BUIR                ALLU                 BUIR
72               BUIR          BUIR                ALLU                 BUIR
73               LOSA          LOSA                MAME                 LOSA
74               LOSA          LOSA                MAME                 LOSA
449              MEOS          MEOS                MAME                 MEOS
450              JEDI          JEDI                MAME                 JEDI
    KF_VERSTEHEN_AE KF_VERSTEHEN KF_KOMMUNIKATION_VERSTEHEN
71             &lt;NA&gt;         &lt;NA&gt;                       &lt;NA&gt;
72             &lt;NA&gt;         &lt;NA&gt;                       &lt;NA&gt;
73             &lt;NA&gt;         &lt;NA&gt;                       &lt;NA&gt;
74             &lt;NA&gt;         &lt;NA&gt;                       &lt;NA&gt;
449            &lt;NA&gt;         &lt;NA&gt;                       &lt;NA&gt;
450            MAME            7                 3 = beides
    KF_KOMMUNIKATION_VERSTEHEN_AE KF_AUSDRUCK KF_AUSDRUCK_AE
71                           &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;
72                           &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;
73                           &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;
74                           &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;
449                          &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;
450                          MAME           7           MAME
    KF_KOMMUNIKATION_AUSDRUCK KF_KOMMUNIKATION_AUSDRUCK_AE
71                       &lt;NA&gt;                         &lt;NA&gt;
72                       &lt;NA&gt;                         &lt;NA&gt;
73                       &lt;NA&gt;                         &lt;NA&gt;
74                       &lt;NA&gt;                         &lt;NA&gt;
449                      &lt;NA&gt;                         &lt;NA&gt;
450                3 = beides                         MAME
    KF_SOZIALES_VERHALTEN KF_SOZIALES_VERHALTEN_AE KF_PROBLEM_LOESUNG
71                   &lt;NA&gt;                     &lt;NA&gt;               &lt;NA&gt;
72                   &lt;NA&gt;                     &lt;NA&gt;               &lt;NA&gt;
73                   &lt;NA&gt;                     &lt;NA&gt;               &lt;NA&gt;
74                   &lt;NA&gt;                     &lt;NA&gt;               &lt;NA&gt;
449                  &lt;NA&gt;                     &lt;NA&gt;               &lt;NA&gt;
450                     7                     MAME                  7
    KF_PROBLEM_LOESUNG_AE KF_SUB     date.x   code2 uniq.x   code1     date.y
71                   &lt;NA&gt;   &lt;NA&gt; 2017-02-21 6004334 uni_34    &lt;NA&gt;       &lt;NA&gt;
72                   &lt;NA&gt;   &lt;NA&gt; 2017-02-21 6004334 uni_34    &lt;NA&gt;       &lt;NA&gt;
73                   &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;
74                   &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;       &lt;NA&gt;
449                  &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt; 5217254 2017-01-11
450                  MAME     34       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt; 5217254 2017-01-11
     uniq.y
71     &lt;NA&gt;
72     &lt;NA&gt;
73     &lt;NA&gt;
74     &lt;NA&gt;
449 uni_247
450 uni_247</code></pre>
</div>
</div>
<p>If everything is ok, when uniq.x has any value uni.y should be with &lt;NA&gt; and reversal. The next chunk evaluates if both columns uniq.x and uniq.y are not empty at the same time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#P2 %&gt;% filter(uniq.x!=""&amp;uniq.y!="")</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0 rows has both values empty at the same time</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>P2<span class="sc">$</span>uniq.x<span class="ot">&lt;-</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(P2<span class="sc">$</span>uniq.x),<span class="st">""</span>,P2<span class="sc">$</span>uniq.x)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>P2<span class="sc">$</span>uniq.y<span class="ot">&lt;-</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(P2<span class="sc">$</span>uniq.y),<span class="st">""</span>,P2<span class="sc">$</span>uniq.y)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>P2<span class="sc">$</span>unique<span class="ot">&lt;-</span><span class="fu">paste</span>(P2<span class="sc">$</span>uniq.x,P2<span class="sc">$</span>uniq.y,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(P2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FID    NR PATIENT_NR FALL_NR KURZZEICHEN LASTMEASURE SP_NAHRUNG
1 5205639 36604      73510      34         CUS          NA          0
2 5205639 46713      73510      34        PUNO          NA          0
3 5207178 38222     396796       2         HON          NA          1
4 5207178 44542     396796       2        SILG          NA          2
5 5208756 38801     398190       3        ROBA          NA          2
6 5208756 42935     398190       3        ENBE          NA          3
  SP_WASCHEN_OBER SP_WASCHEN_UNTER SP_ANZIEHEN_OBER SP_ANZIEHEN_UNTER
1               0                0                0                 0
2               0                0                0                 0
3               0                0                0                 0
4               0                0                1                 1
5               1                0                0                 0
6               3                1                4                 2
  SP_GESICHT SP_SUB AS_ATMUNG AS_BLASE AS_DARM AS_TOILETTE AS_SUB MH_BETT
1          0      0        10        0       5           0     15       0
2          0      0        10        3       5           0     18       0
3          1      2         4        3       5           0     12       0
4          0      4        10        6      10           1     27       2
5          1      4        10        0       0           0     10       0
6          3     16        10       11      10           5     36       4
  MH_TRANSFER_BETT MH_TRANSFER_WC MH_SUB MA_HAUS MA_MITTLERE_DISTANZ
1                0              0      0       0                   0
2                0              0      0       1                   1
3                0              0      0       1                   1
4                2              1      5       2                   2
5                0              0      0       0                   0
6                2              1      7       1                   1
  MA_AUSSER_HAUS MA_TREPPEN MA_TRANSFER_AUTO MA_TRANSFER_BODEN MA_SUB
1              0          0                0                 0      0
2              1          0                0                 0      3
3              1          0                0                 0      3
4              1          0                1                 0      6
5              0          0                0                 0      0
6              1          0                1                 0      4
  SCIM_TOTAL      DATUM   ERZEUGER     ERZEUGUNGSDATUM AENDERER AENDERUNGSDATUM
1         15 2015-10-29    SMITH_C 2015-10-29 22:15:23       NA              NA
2         21 2017-08-16   PUERRO_N 2017-08-16 08:10:28       NA              NA
3         17 2016-01-01    HOFER_N 2015-12-31 07:57:54       NA              NA
4         42 2017-04-25  GRETHER_S 2017-04-25 14:59:53       NA              NA
5         14 2016-03-01 BACHMANN_R 2016-02-26 11:13:36       NA              NA
6         63 2017-02-08   ENDERS_B 2017-02-06 08:37:41       NA              NA
                          ERZ_CLIENT_INFO ERSTELLER_ERGO ERSTELLER_PFLEGE
1  KgEd32@SPGVCMP00026-3.0.0.0-2.2.0.1921           JUST              CUS
2      KgEd32@SPG16010-3.0.0.0-2.2.0.2143            CLE             PUNO
3  KgEd32@SPGVCMP00040-3.0.0.0-2.2.0.2027           ANWA              REC
4      KgEd32@SPG01806-3.0.0.0-2.2.0.2143           SILG              NIV
5      KgEd32@SPG01734-3.0.0.0-2.2.0.2054           FENI             BYZY
6 KgEd32@SPGPVCMP00065-3.0.0.0-2.2.0.2085           ENBE              BER
  ERSTELLER_PHYSIO SP_NAHRUNG_AE SP_WASCHEN_OBER_AE SP_WASCHEN_UNTER_AE
1             KOST           CUS                CUS                 CUS
2             KOST          PUNO               PUNO                PUNO
3              HON           REC                REC                 REC
4             SILG           NIV                NIV                 NIV
5             ROSE          BYZY               BYZY                BYZY
6              JED           BER                BER                 BER
  SP_ANZIEHEN_OBER_AE SP_ANZIEHEN_UNTER_AE SP_GESICHT_AE AS_ATMUNG_AE
1                 CUS                  CUS           CUS          CUS
2                PUNO                 PUNO          PUNO         PUNO
3                 REC                  REC           REC          REC
4                 NIV                  NIV           NIV          NIV
5                BYZY                 BYZY          BYZY         BYZY
6                 BER                  BER           BER          BER
  AS_BLASE_AE AS_DARM_AE AS_TOILETTE_AE MH_BETT_AE MH_TRANSFER_BETT_AE
1         CUS        CUS            CUS        CUS                JUST
2        PUNO       PUNO           PUNO       PUNO                 CLE
3         REC        REC            REC        REC                ANWA
4         NIV        NIV            NIV        NIV                SILG
5        BYZY       BYZY           BYZY       BYZY                FENI
6         BER        BER            BER        BER                ENBE
  MH_TRANSFER_WC_AE MA_HAUS_AE MA_MITTLERE_DISTANZ_AE MA_AUSSER_HAUS_AE
1              JUST       KOST                   KOST              KOST
2               CLE       KOST                   KOST              KOST
3              ANWA        HON                    HON               HON
4              SILG       SILG                   SILG              SILG
5              FENI       ROSE                   ROSE              ROSE
6              ENBE        JED                    JED               JED
  MA_TREPPEN_AE MA_TRANSFER_AUTO_AE MA_TRANSFER_BODEN_AE KF_VERSTEHEN_AE
1          KOST                JUST                 KOST            &lt;NA&gt;
2          KOST                 CLE                 KOST             CLE
3           HON                ANWA                  HON            &lt;NA&gt;
4          SILG                SILG                 SILG            &lt;NA&gt;
5          ROSE                FENI                 ROSE            &lt;NA&gt;
6           JED                ENBE                  JED            &lt;NA&gt;
  KF_VERSTEHEN KF_KOMMUNIKATION_VERSTEHEN KF_KOMMUNIKATION_VERSTEHEN_AE
1         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
2            7                 3 = beides                           CLE
3         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
4         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
5         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
6         &lt;NA&gt;                       &lt;NA&gt;                          &lt;NA&gt;
  KF_AUSDRUCK KF_AUSDRUCK_AE KF_KOMMUNIKATION_AUSDRUCK
1        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
2           7            CLE                3 = beides
3        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
4        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
5        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
6        &lt;NA&gt;           &lt;NA&gt;                      &lt;NA&gt;
  KF_KOMMUNIKATION_AUSDRUCK_AE KF_SOZIALES_VERHALTEN KF_SOZIALES_VERHALTEN_AE
1                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
2                          CLE                     7                      CLE
3                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
4                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
5                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
6                         &lt;NA&gt;                  &lt;NA&gt;                     &lt;NA&gt;
  KF_PROBLEM_LOESUNG KF_PROBLEM_LOESUNG_AE KF_SUB date.x code2 uniq.x code1
1               &lt;NA&gt;                  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;
2                  7                   CLE     34   &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;
3               &lt;NA&gt;                  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;
4               &lt;NA&gt;                  &lt;NA&gt;      -   &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;
5               &lt;NA&gt;                  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;
6               &lt;NA&gt;                  &lt;NA&gt;      -   &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;
  date.y uniq.y unique
1   &lt;NA&gt;              
2   &lt;NA&gt;              
3   &lt;NA&gt;              
4   &lt;NA&gt;              
5   &lt;NA&gt;              
6   &lt;NA&gt;              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>P2<span class="sc">$</span>acute<span class="ot">&lt;-</span><span class="fu">ifelse</span>(P2<span class="sc">$</span>uniq.x<span class="sc">==</span><span class="st">""</span>,<span class="st">""</span>,<span class="st">"acute"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>P2<span class="sc">$</span>rehab<span class="ot">&lt;-</span><span class="fu">ifelse</span>(P2<span class="sc">$</span>uniq.y<span class="sc">==</span><span class="st">""</span>,<span class="st">""</span>,<span class="st">"rehab"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>P2<span class="sc">$</span>phase<span class="ot">&lt;-</span><span class="fu">paste</span>(P2<span class="sc">$</span>acute,P2<span class="sc">$</span>rehab,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>P3<span class="ot">&lt;-</span>P2<span class="sc">%&gt;%</span> <span class="fu">select</span>(unique,FID,code1,code2,phase,SCIM_TOTAL)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#head(P2)</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#head(P3)</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>tabl<span class="ot">&lt;-</span><span class="fu">table</span>(P3<span class="sc">$</span>unique)<span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>Freq)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Var1 Freq
1          3976
2  uni_100    4
3 uni_1000    4
4 uni_1001    4
5 uni_1002    4
6 uni_1003    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#P3%&gt;%filter(unique %in% tabl[-1,]$Var1) %&gt;% merge(fid_pid,by.x="FID",by.y="FID")%&gt;% arrange(PID,unique)%&gt;% head(n=20)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>P4<span class="ot">&lt;-</span>P3<span class="sc">%&gt;%</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(FID))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#merge(P4,fid_pid,by.x="FID",by.y="FID") %&gt;% select(PID) %&gt;% table() %&gt;% data.frame()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>P5<span class="ot">&lt;-</span>P3<span class="sc">%&gt;%</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(FID))<span class="sc">%&gt;%</span><span class="fu">merge</span>(P4,fid_pid,<span class="at">by.x=</span><span class="st">"FID"</span>,<span class="at">by.y=</span><span class="st">"FID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mb %&gt;% select(id) |&gt; table() |&gt; data.frame() |&gt; filter(Freq==2) |&gt; head(n=15)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#mb |&gt; filter(id=="6006658")</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#codes %&gt;% filter(code2=="6006658")</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#mb |&gt; filter(id%in% c("6004319","6006658"))</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>mb2 <span class="ot">&lt;-</span> mb  <span class="sc">|&gt;</span> <span class="fu">merge</span>(fid_pid,<span class="at">by.x =</span> <span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"FID"</span>,<span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>mb3 <span class="ot">&lt;-</span> mb2 <span class="sc">|&gt;</span> <span class="fu">merge</span>(codes,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"code1"</span>,<span class="at">all.x=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(codes,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"code2"</span>,<span class="at">all.x=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">acute=</span><span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(code2),<span class="st">"reha"</span>,<span class="st">""</span>))<span class="sc">|&gt;</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rehab=</span><span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(code1),<span class="st">"acute"</span>,<span class="st">""</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">phase=</span><span class="fu">paste</span>(acute,rehab,<span class="at">sep=</span><span class="st">""</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>acute,<span class="sc">-</span>rehab) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(PID)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co">#mb3|&gt; filter(phase=="acute")</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>tfp <span class="ot">&lt;-</span> fid_pid <span class="sc">%&gt;%</span> <span class="fu">select</span>(PID) <span class="sc">%&gt;%</span> table <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>Freq)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co">#mb3 %&gt;% filter(PID %in% tfp$PID)</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">#mb3 %&gt;% filter(PID=="0152021")</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co">#mb3 %&gt;% select(PID) %&gt;% table()%&gt;%data.frame() %&gt;% arrange(-Freq) %&gt;% head(20)</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co">#mb3 %&gt;% select(PID,id,entry_date,phase)</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> mb3 <span class="sc">|&gt;</span> <span class="fu">filter</span>(PID<span class="sc">==</span><span class="st">"0019699"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(id)</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>fids <span class="ot">&lt;-</span> SCIM_17_20 <span class="sc">%&gt;%</span> </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FID <span class="sc">%in%</span> ids<span class="sc">$</span>id) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(DATUM) <span class="sc">%&gt;%</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FID)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Clinical pathways</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>cpth<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"C:/Users/boris/Desktop/data hospital/cpth.rds"</span>)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>ind_cpth <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"C:/Users/boris/Desktop/data hospital/ind_cpth.xlsx"</span>)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>mb4 <span class="ot">&lt;-</span> mb3 <span class="sc">%&gt;%</span> <span class="fu">merge</span>(cpth,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"V1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(ind_cpth,<span class="at">by.x=</span><span class="st">"clipath_code"</span>,<span class="at">by.y=</span><span class="st">"Indication"</span>) </span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd("C:/Users/boris/Desktop/SPZ hospital/SPZ-Project")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataset-serv_cons" class="level1">
<h1>Dataset serv_cons</h1>
<p>serv_cons: contains the aggregated information of FID and units of interventions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#head(serv_cons)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>time_cost<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"time_cost.rds"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>serv_cons<span class="ot">&lt;-</span>time_cost<span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>year) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">op_room=</span><span class="fu">sum</span>(op_room),<span class="at">anaest=</span><span class="fu">sum</span>(anaest),<span class="at">int_care=</span><span class="fu">sum</span>(int_care),<span class="at">imag=</span><span class="fu">sum</span>(imag),<span class="at">lab=</span><span class="fu">sum</span>(lab),<span class="at">physt=</span><span class="fu">sum</span>(physt),<span class="at">ergo=</span><span class="fu">sum</span>(ergo),<span class="at">logo=</span><span class="fu">sum</span>(logo),<span class="at">non_med=</span><span class="fu">sum</span>(non_med_ter),<span class="at">nurs=</span><span class="fu">sum</span>(nurs),<span class="at">psyc=</span><span class="fu">sum</span>(psyc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we identify the phases for every id in the previous table:</p>
<p>The first part merge by id and code1 (acute phase) to obtain uniq code and aggregate, the second part the same procedure but with code2 (rehab phase)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>serv_cons1<span class="ot">&lt;-</span>serv_cons<span class="sc">%&gt;%</span> <span class="fu">merge</span>(codes<span class="sc">%&gt;%</span> <span class="fu">select</span>(code1,uniq),<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.=</span><span class="st">"code1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(fid_pid,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"FID"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">phase=</span><span class="st">"acu"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>serv_cons2<span class="ot">&lt;-</span>serv_cons<span class="sc">%&gt;%</span> <span class="fu">merge</span>(codes<span class="sc">%&gt;%</span> <span class="fu">select</span>(code2,uniq),<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.=</span><span class="st">"code2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(fid_pid,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"FID"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">phase=</span><span class="st">"rehab"</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>serv_cons_phase <span class="ot">&lt;-</span> <span class="fu">rbind</span>(serv_cons1,serv_cons2)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We see the number of times that every FID appears in the table and phase</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>serv_cons_phase <span class="sc">%&gt;%</span> <span class="fu">select</span>(PID) <span class="sc">%&gt;%</span> </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>Freq) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      PID Freq
1 0000374    6
2 0000362    4
3 0000477    2
4 0000511    2
5 0000548    2
6 0000567    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We check the first code </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>serv_cons_phase <span class="sc">|&gt;</span> <span class="fu">filter</span>(PID<span class="sc">==</span><span class="st">"0000374"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="st">"PID"</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="st">"uniq"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id     PID op_room anaest int_care phase  uniq
1 6028398 0000374       0      0    13398   acu uni_3
2 6040865 0000374     152    478      287   acu uni_4
3 6043203 0000374       0      0      555   acu uni_5
4 6028919 0000374       0      0        0 rehab uni_3
5 6041525 0000374       0      0        0 rehab uni_4
6 6043916 0000374       0      0       75 rehab uni_5</code></pre>
</div>
</div>
</section>
<section id="lesion-level" class="level1">
<h1>Lesion Level</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>colores <span class="ot">&lt;-</span> <span class="fu">get_palette</span>(<span class="at">palette=</span><span class="st">"lancet"</span>,<span class="dv">12</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_palette</span>(<span class="at">palette=</span><span class="st">"futurama"</span>,<span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "#FF6F00FF" "#C71000FF" "#008EA0FF" "#8A4198FF" "#5A9599FF" "#FF6348FF"
 [7] "#84D7E1FF" "#FF95A8FF" "#3D3B25FF" "#ADE2D0FF" "#1A5354FF" "#3F4041FF"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_palette</span>(<span class="at">palette=</span><span class="st">"simpsons"</span>,<span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "#FED439FF" "#709AE1FF" "#8A9197FF" "#D2AF81FF" "#FD7446FF" "#D5E4A2FF"
 [7] "#197EC0FF" "#F05C3BFF" "#46732EFF" "#71D0F5FF" "#370335FF" "#075149FF"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_palette</span>(<span class="at">palette=</span><span class="st">"tron"</span>,<span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "#FF410D" "#AF9891" "#7ADFEC" "#C5CF7B" "#E5C638" "#AFCA51" "#A5D183"
 [8] "#C5DBCD" "#DEC69D" "#F3A230" "#BB945B" "#748AA6"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#paleta&lt;-get_palette(palette="simpsons",k = k)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>mb <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Lesion.x,<span class="at">fill=</span>Lesion.x))<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>)<span class="sc">+</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))<span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Report_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mb_final<span class="ot">&lt;-</span>mb <span class="sc">|&gt;</span> <span class="fu">merge</span>(cpth,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"V1"</span>) <span class="sc">|&gt;</span><span class="fu">merge</span>(ind_cpth,<span class="at">by.x=</span><span class="st">"clipath_code"</span>,<span class="at">by.y=</span><span class="st">"Indication"</span>) </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>lesion_level<span class="ot">&lt;-</span>readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"lesion_level.xlsx"</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">merge</span>(mb_final,lesion_level,<span class="at">by.x=</span><span class="st">"les_lev"</span>,<span class="at">by.y=</span><span class="st">"ICD"</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>mb_final<span class="sc">$</span>Lesion1<span class="ot">&lt;-</span><span class="fu">substr</span>(<span class="at">x =</span> mb_final<span class="sc">$</span>Lesion,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Threemap</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>tabtree <span class="ot">&lt;-</span> mb_final <span class="sc">|&gt;</span> <span class="fu">select</span>(main_diag,Lesion1)<span class="sc">|&gt;</span> <span class="fu">table</span>()<span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">group_by</span>(main_diag,Lesion1)<span class="sc">|&gt;</span><span class="fu">summarize</span>(<span class="at">tot=</span><span class="fu">sum</span>(Freq))<span class="sc">|&gt;</span><span class="fu">filter</span>(main_diag<span class="sc">!=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'main_diag'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#treemap(tabtree,index=c("Lesion1","main_diag"),vSize="tot",type="index",palette=palet)</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#icd.data::icd10cm2016</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>mb_final<span class="sc">$</span>icddesc<span class="ot">&lt;-</span><span class="fu">substr</span>(mb_final<span class="sc">$</span>main_diag,<span class="dv">1</span>,<span class="dv">3</span>) </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>desc <span class="ot">&lt;-</span> icd.data<span class="sc">::</span>icd10cm2016 <span class="sc">|&gt;</span> <span class="fu">filter</span>(code<span class="sc">%in%</span> </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mb_final<span class="sc">$</span>icddesc))<span class="sc">|&gt;</span><span class="fu">select</span>(<span class="st">"code"</span>,<span class="st">"short_desc"</span>)<span class="sc">|&gt;</span><span class="fu">data.frame</span>()</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>mb_final<span class="ot">&lt;-</span>mb_final<span class="sc">|&gt;</span><span class="fu">merge</span>(desc,<span class="at">by.x=</span><span class="st">"icddesc"</span>,<span class="at">by.y=</span><span class="st">"code"</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>tabtree<span class="ot">&lt;-</span>mb_final <span class="sc">|&gt;</span> <span class="fu">select</span>(Lesion1,short_desc)<span class="sc">|&gt;</span> <span class="fu">table</span>()<span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Lesion1,short_desc)<span class="sc">|&gt;</span><span class="fu">summarize</span>(<span class="at">tot=</span><span class="fu">sum</span>(Freq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Lesion1'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>tabtree2<span class="ot">&lt;-</span>tabtree<span class="sc">|&gt;</span><span class="fu">filter</span>(<span class="sc">!</span>short_desc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Paraplegia (parapesis) and quadriplegia (quadriparesis)"</span>,<span class="st">"Paraplegia (paraparesis) and quadriplegia (quadriparesis)"</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">#treemap(tabtree2,index=c("Lesion1","short_desc"),vSize="tot",type="index",palette=palet)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(serv_cons_phase)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "id"       "op_room"  "anaest"   "int_care" "imag"     "lab"     
 [7] "physt"    "ergo"     "logo"     "non_med"  "nurs"     "psyc"    
[13] "uniq"     "PID"      "phase"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>serv2 <span class="ot">&lt;-</span> serv_cons_phase<span class="sc">|&gt;</span> <span class="fu">merge</span>(cpth,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"V1"</span>) <span class="sc">|&gt;</span><span class="fu">merge</span>(ind_cpth,<span class="at">by.x=</span><span class="st">"clipath_code"</span>,<span class="at">by.y=</span><span class="st">"Indication"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#We compute the total lenght of stay for each id (FID)</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>Tab1<span class="ot">&lt;-</span>mb_final <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id)<span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">length_stay=</span><span class="fu">sum</span>(length_stay),<span class="at">gender=</span><span class="fu">first</span>(gender),<span class="at">age=</span><span class="fu">first</span>(age_admi),<span class="at">les=</span><span class="fu">first</span>(les))</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mb_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "icddesc"          "clipath_code"     "id"               "les_lev"         
 [5] "gender"           "birth_date"       "age_admi"         "resid"           
 [9] "entry"            "class"            "stay_intcareunit" "main_cost_center"
[13] "leave"            "stay_aft_leav"    "main_diag"        "add_main_diag"   
[17] "add_diag1"        "add_diag2"        "add_diag3"        "add_diag4"       
[21] "add_diag5"        "add_diag6"        "add_diag7"        "add_diag8"       
[25] "begin_main_treat" "fur_treat1"       "fur_treat2"       "fur_treat3"      
[29] "fur_treat4"       "fur_treat5"       "fur_treat6"       "fur_treat7"      
[33] "fur_treat8"       "fur_treat9"       "fur_treat10"      "year.x"          
[37] "length_stay"      "Lesion.x"         "les"              "year.y"          
[41] "Clinical.Pathway" "Lesion1"          "short_desc"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>Tab1<span class="sc">$</span>length_stay<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(Tab1<span class="sc">$</span>length_stay)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>serv3 <span class="ot">&lt;-</span> serv2<span class="sc">|&gt;</span><span class="fu">merge</span>(Tab1,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"id"</span>)<span class="sc">|&gt;</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">psy1=</span>psyc<span class="sc">/</span>length_stay,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">op=</span>op_room<span class="sc">/</span>length_stay,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ana=</span>anaest<span class="sc">/</span>length_stay,<span class="at">nurs=</span>nurs<span class="sc">/</span>length_stay,<span class="at">int_care=</span>int_care<span class="sc">/</span>length_stay,<span class="at">img=</span>imag<span class="sc">/</span>length_stay,<span class="at">lb=</span>lab<span class="sc">/</span>length_stay,<span class="at">incare=</span>int_care<span class="sc">/</span>length_stay,<span class="at">ergo=</span>ergo<span class="sc">/</span>length_stay)<span class="sc">|&gt;</span><span class="fu">select</span>(op,ana,img,nurs,lb,incare,Clinical.Pathway)<span class="sc">|&gt;</span><span class="fu">group_by</span>(Clinical.Pathway)<span class="sc">|&gt;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_op=</span><span class="fu">mean</span>(op,<span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="at">avg_ana=</span><span class="fu">mean</span>(ana,<span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="at">avg_img=</span><span class="fu">mean</span>(img,<span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="at">avg_lb=</span><span class="fu">mean</span>(lb,<span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="at">avg_incare=</span><span class="fu">mean</span>(incare,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  treemap_pathways <span class="ot">&lt;-</span> <span class="fu">gather</span>(serv3,A,V,avg_op<span class="sc">:</span>avg_incare)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>treemap_pathways<span class="sc">|&gt;</span><span class="fu">arrange</span>(Clinical.Pathway,A,V)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 3
   Clinical.Pathway   A               V
   &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt;
 1 Erstrehabilitation avg_ana     2.47 
 2 Erstrehabilitation avg_img    50.9  
 3 Erstrehabilitation avg_incare  4.84 
 4 Erstrehabilitation avg_lb     77.3  
 5 Erstrehabilitation avg_op      0.753
 6 Handhandchirurgie  avg_ana    36.6  
 7 Handhandchirurgie  avg_img    23.2  
 8 Handhandchirurgie  avg_incare  1.58 
 9 Handhandchirurgie  avg_lb     48.2  
10 Handhandchirurgie  avg_op     11.8  
# … with 20 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>serv_ersrehab<span class="ot">&lt;-</span>serv2<span class="sc">|&gt;</span><span class="fu">merge</span>(Tab1,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"id"</span>)<span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">psy1=</span>psyc<span class="sc">/</span>length_stay,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">op=</span>op_room<span class="sc">/</span>length_stay,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ana=</span>anaest<span class="sc">/</span>length_stay,<span class="at">nurs=</span>nurs<span class="sc">/</span>length_stay,<span class="at">int_care=</span>int_care<span class="sc">/</span>length_stay,<span class="at">img=</span>imag<span class="sc">/</span>length_stay,<span class="at">lb=</span>lab<span class="sc">/</span>length_stay,<span class="at">incare=</span>int_care<span class="sc">/</span>length_stay,<span class="at">ergo=</span>ergo<span class="sc">/</span>length_stay)<span class="sc">|&gt;</span><span class="fu">select</span>(PID,les,id,age,psy1,op,ana,img,nurs,lb,incare,Clinical.Pathway,gender)<span class="sc">|&gt;</span><span class="fu">filter</span>(Clinical.Pathway<span class="sc">==</span><span class="st">"Erstrehabilitation"</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>serv_ersrehab<span class="sc">|&gt;</span><span class="fu">group_by</span>(gender)<span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">mean</span>(psy1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  gender `mean(psy1)`
  &lt;chr&gt;         &lt;dbl&gt;
1 1              10.8
2 2              12.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tab2<span class="ot">&lt;-</span>serv2<span class="sc">|&gt;</span><span class="fu">merge</span>(Tab1,<span class="at">by.x=</span><span class="st">"id"</span>,<span class="at">by.y=</span><span class="st">"id"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>tab22<span class="ot">&lt;-</span>tab2 <span class="sc">|&gt;</span> <span class="fu">filter</span>(Clinical.Pathway<span class="sc">==</span><span class="st">"Erstrehabilitation"</span>,phase<span class="sc">==</span><span class="st">"rehab"</span>) </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(tab22<span class="sc">$</span>length_stay,<span class="at">breaks =</span> <span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Report_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "id"               "clipath_code"     "op_room"          "anaest"          
 [5] "int_care"         "imag"             "lab"              "physt"           
 [9] "ergo"             "logo"             "non_med"          "nurs"            
[13] "psyc"             "uniq"             "PID"              "phase"           
[17] "year"             "Clinical.Pathway" "length_stay"      "gender"          
[21] "age"              "les"             </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>